<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Android Virtual Keyboard Double Show Test</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.5; }
  button { padding: 12px 18px; font-size: 16px; margin-right: 10px; }
  #log { margin-top: 20px; background: #f0f0f0; padding: 12px; white-space: pre-wrap; }
  textarea { width: 100%; height: 80px; font-size: 18px; }
</style>
</head>
<body>

<h2>Android Virtual Keyboard Double Show Test</h2>

<p>This test calls <code>navigator.virtualKeyboard.show()</code> <strong>twice</strong> when you tap "Show Keyboard".</p>

<button id="showBtn">Show Keyboard</button>
<button id="hideBtn">Hide Keyboard</button>

<br><br>

<textarea id="ta" placeholder="Textarea for forced focus…"></textarea>

<pre id="log"></pre>

<script>
const log = msg => {
  document.getElementById('log').textContent += msg + "\n";
};

// Check API support
if ('virtualKeyboard' in navigator) {
  log("navigator.virtualKeyboard = OK");
  try {
    navigator.virtualKeyboard.overlaysContent = true;
    log("overlaysContent = true");
  } catch (e) {
    log("Failed to set overlaysContent: " + e);
  }
} else {
  log("❌ navigator.virtualKeyboard NOT supported.");
}

// Show keyboard twice
document.getElementById("showBtn").onclick = () => {
  const ta = document.getElementById("ta");
  ta.focus(); // MUST focus first

  // Optional: Fullscreen trick for Android Chrome
  document.documentElement.requestFullscreen()
    .then(() => setTimeout(() => document.exitFullscreen(), 120))
    .catch(e => log("Fullscreen request failed: " + e));

  // Call show() twice with small delay
  setTimeout(() => {
    if (navigator.virtualKeyboard?.show) {
      navigator.virtualKeyboard.show()
        .then(() => log("Requested: show() [1st call]"))
        .catch(e => log("show() error [1st call]: " + e));

      setTimeout(() => {
        navigator.virtualKeyboard.show()
          .then(() => log("Requested: show() [2nd call]"))
          .catch(e => log("show() error [2nd call]: " + e));
      }, 50);
    } else {
      log("❌ virtualKeyboard.show() not supported");
    }
  }, 50);
};

// Hide keyboard
document.getElementById("hideBtn").onclick = () => {
  if (navigator.virtualKeyboard?.hide) {
    navigator.virtualKeyboard.hide()
      .then(() => log("Requested: hide()"))
      .catch(e => log("hide() error: " + e));
  } else {
    log("❌ virtualKeyboard.hide() not supported");
  }
};

// Listen to geometry change events
if ('virtualKeyboard' in navigator) {
  navigator.virtualKeyboard.ongeometrychange = (ev) => {
    log("geometrychange: keyboard height = " +
        navigator.virtualKeyboard.boundingRect.height + "px");
  };
}
</script>

</body>
</html>
